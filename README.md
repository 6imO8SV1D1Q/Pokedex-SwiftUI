# Pokedex-SwiftUI

SwiftUIで実装したポケモン図鑑アプリケーション。PokéAPI v2を使用して全ポケモンの情報を表示します。

## 主な機能

### v3.0の新機能（詳細画面の大幅拡充）

#### 1. フォルム切り替え
- **リージョンフォーム**: アローラ、ガラル、ヒスイ、パルデア
- **メガシンカ**: X-Y以降のバージョンで表示
- **フォルムチェンジ**: ロトム、デオキシスなど
- フォーム変更時に画像、タイプ、種族値、実数値が自動更新

#### 2. タイプ相性表示
- **攻撃面**: このポケモンの技が効果ばつぐんになるタイプ
- **防御面**: 受けるダメージの倍率別表示
  - 効果ばつぐん（4倍/2倍）
  - いまひとつ（1/2倍/1/4倍）
  - 効果なし
- 複合タイプの相性計算に対応

#### 3. 実数値計算
- **5パターン表示**（レベル50固定）:
  - 理想個体（31IV/252EV/性格補正↑）
  - 252振り（31IV/252EV）
  - 無振り（31IV/0EV）
  - 最低（0IV/0EV）
  - 下降補正（0IV/0EV/性格補正↓）
- フォーム切り替え時に自動再計算

#### 4. 進化ルート表示
- **ツリー形式**: 進化の流れを視覚的に表示
- **進化条件**: レベル、進化石、通信交換、なつき度など
- **分岐進化**: イーブイなど複数の進化先に対応
- タップで進化先/進化前ポケモンの詳細画面に遷移

#### 5. 追加情報
- **図鑑説明**: バージョンごとのフレーバーテキスト
- **生息地**: 選択中のバージョンでの出現場所
- **性別比**: ♂/♀の出現比率（性別不明含む）
- **たまごグループ**: 遺伝グループ表示

#### 6. 特性詳細
- **通常特性**: 最大2つ
- **隠れ特性**: 第5世代以降
- **詳細説明**: 英語の効果説明文
- バージョングループによる表示制御（第1-2世代は非表示）

#### 7. 技一覧の拡充
- **TM/TR/HM番号**: バージョンごとの番号表示
- **技詳細情報**: タイプ、分類、威力、命中、PP、効果説明
- **習得方法別表示**: レベルアップ、TM、TR、HM、タマゴ、教え技
- **ソート**: レベルアップは昇順、マシンは番号順

### v2.0の新機能

#### 1. バージョングループ別表示
- **全国図鑑モード**: 全ポケモン（1025匹）を最新仕様で表示
- **バージョングループ選択**: 各ゲーム世代のポケモンと仕様で表示
  - 赤・緑・青、金・銀、ルビー・サファイア、ダイヤモンド・パール...など22種類
  - タイプ、特性、種族値が各バージョングループの仕様で表示される

#### 2. 拡張されたポケモン情報表示
- **特性表示**: 通常特性と隠れ特性を表示
  - 第1〜2世代：特性システム未実装のため非表示
  - 第3〜4世代：通常特性のみ
  - 第5世代以降：通常特性 + 隠れ特性
- **種族値表示**: HP/攻撃/防御/特攻/特防/素早さと合計値
  - 表示形式: `45-49-49-65-65-45 (318)`

#### 3. 高度なフィルター機能
- **タイプフィルター**: 複数タイプで絞り込み（既存機能）
- **特性フィルター**: 特性で絞り込み
  - 全国図鑑モード、第3世代以降で利用可能
  - 通常特性・隠れ特性の両方に対応
- **技フィルター**: 複数の技（最大4つ）で絞り込み
  - バージョングループ選択時のみ利用可能
  - 習得方法も表示（レベル、TM/TR、タマゴ技など）

#### 4. ソート機能
- 図鑑番号（デフォルト）
- 名前（昇順/降順）
- 種族値合計（昇順/降順）
- 各ステータス（HP、攻撃、防御、特攻、特防、素早さ）

#### 5. UI/UX改善
- リスト/グリッド表示切り替え
- ローディングプログレスバー表示
- スクロール位置保持（詳細画面から戻った時）

### v1.0の機能
- ポケモン一覧表示
- ポケモン詳細表示
- タイプフィルター
- 名前検索
- キャッシュ機能（Kingfisher）

## アーキテクチャ

Clean Architecture + MVVMパターンを採用

```
├── Domain/          # エンティティ、ユースケース、プロトコル
├── Data/            # リポジトリ、API、キャッシュ
├── Presentation/    # ビュー、ビューモデル
└── Application/     # 依存性注入
```

### 主要コンポーネント

**Domain層:**
- **Entity**:
  - `Pokemon` / `PokemonListItem`: ポケモンエンティティ
  - `VersionGroup`: バージョングループエンティティ
  - `MoveEntity`: 技エンティティ
  - `PokemonForm`: フォームエンティティ（v3.0）
  - `TypeMatchup`: タイプ相性エンティティ（v3.0）
  - `CalculatedStats`: 実数値エンティティ（v3.0）
- **UseCase**:
  - `FetchPokemonListUseCase`: ポケモンリスト取得
  - `FilterPokemonByMovesUseCase`: 技フィルター
  - `SortPokemonUseCase`: ソート
  - `FetchPokemonFormsUseCase`: フォーム取得（v3.0）
  - `FetchTypeMatchupUseCase`: タイプ相性計算（v3.0）
  - `CalculateStatsUseCase`: 実数値計算（v3.0）

**Data層:**
- **Repository**:
  - `PokemonRepository`: ポケモンデータ取得
  - `MoveRepository`: 技データ取得
  - `TypeRepository`: タイプデータ取得（v3.0）
- **API**: `PokemonAPIClient` - PokéAPI通信
- **Cache**: Actor-basedメモリキャッシュ
  - `MoveCache`, `TypeCache`, `FormCache`, `AbilityCache`, `LocationCache`

**Presentation層:**
- `PokemonListViewModel`: 一覧画面のビジネスロジック
- `PokemonDetailViewModel`: 詳細画面ロジック

## 技術スタック

- **言語**: Swift 6.0
- **フレームワーク**: SwiftUI
- **最小デプロイメントターゲット**: iOS 17.0
- **依存ライブラリ**:
  - Kingfisher (画像キャッシュ)
- **API**: PokéAPI v2 (https://pokeapi.co/)

## セットアップ

### 必要要件
- Xcode 15.0+
- iOS 17.0+

### インストール手順

1. リポジトリをクローン
```bash
git clone https://github.com/yourusername/Pokedex-SwiftUI.git
cd Pokedex-SwiftUI
```

2. 依存関係の解決
```bash
# Kingfisherは自動的に解決されます
```

3. Xcodeでプロジェクトを開く
```bash
open Pokedex/Pokedex.xcodeproj
```

4. ビルド＆実行
- ターゲットデバイス/シミュレータを選択
- Cmd+R でビルド＆実行

## 使い方

### 基本操作

1. **バージョングループ選択**
   - 画面上部のドロップダウンからバージョングループを選択
   - 「全国図鑑」または各ゲームバージョンを選択可能

2. **フィルター機能**
   - 虫眼鏡アイコンをタップして検索画面を開く
   - タイプ、特性、技で絞り込み可能
   - 技フィルターはバージョングループ選択時のみ有効

3. **ソート機能**
   - 「ソート」ボタンをタップ
   - 種族値合計や各ステータスでソート可能

4. **表示モード切り替え**
   - リスト/グリッドアイコンで表示を切り替え

### 制約事項

- **技フィルター**: バージョングループ選択時のみ利用可能
  - 理由: 技の習得方法がバージョンごとに異なるため
- **特性フィルター**: 第1〜2世代では利用不可
  - 理由: 特性システムが未実装の世代のため
- **初回ロード**: 全ポケモン取得のため数秒かかる場合あり

## パフォーマンス

- **初回ロード**: 全ポケモンデータ取得のため時間がかかる（プログレスバー表示）
- **バージョングループ切り替え**: キャッシュにより2回目以降は高速
- **フィルター処理**: タイプ・特性は即座、技フィルターはAPI呼び出しのため時間がかかる
- **画像キャッシュ**: Kingfisherによるメモリ・ディスクキャッシュ

## テスト

### ユニットテスト実行

Xcodeから:
```
Cmd+U
```

コマンドラインから:
```bash
xcodebuild test -scheme Pokedex -destination 'platform=iOS Simulator,name=iPhone 15'
```

### テスト構成

- **ユニットテスト**: 基本的なUseCasesとViewModelsをカバー
  - **v2.0テスト**:
    - `FetchPokemonListUseCaseTests`
    - `FilterPokemonByMovesUseCaseTests`
    - `FetchAllMovesUseCaseTests`
    - `FetchEvolutionChainUseCaseTests`
    - `PokemonListViewModelTests`
    - `PokemonDetailViewModelTests`
    - `MoveCacheTests`
  - **v3.0テスト**:
    - `CalculateStatsUseCaseTests`: 実数値計算
    - `FetchTypeMatchupUseCaseTests`: タイプ相性計算
    - `FetchPokemonFormsUseCaseTests`: フォルム取得
- **統合テスト**: 4件
  - バージョングループ切り替え
  - フィルター連携
  - ソート機能
  - エラーハンドリング
- **パフォーマンステスト**: 7件
  - 初回ロード、キャッシュロード、フィルター処理速度など

### テストカバレッジの現状

- **Domain層**: 主要UseCasesをカバー
- **Data層**: 一部のキャッシュ機能のみ
- **Presentation層**: 基本的なViewModelロジックのみ
- **UIテスト**: 未実装

## トラブルシューティング

### よくある問題

**Q: 初回ロードが遅い**
- A: 全ポケモンデータを取得するため、初回は時間がかかります。2回目以降はキャッシュが効くため高速になります。

**Q: 技フィルターが使えない**
- A: 全国図鑑モードでは技フィルターは無効です。バージョングループを選択してください。

**Q: ネットワークエラーが発生する**
- A: PokéAPIへの接続を確認してください。また、短時間に大量のリクエストを送るとレート制限がかかる場合があります。

**Q: 画像が表示されない**
- A: ネットワーク接続を確認してください。Kingfisherが自動的にリトライします。

## 今後の予定

- [x] リージョンフォーム対応（v3.0で実装）
- [x] タイプ相性表示（v3.0で実装）
- [ ] お気に入り機能（永続化）
- [ ] オフライン完全対応
- [ ] タイプ相性チェッカー（独立機能）
- [ ] ポケモン比較機能
- [ ] ダークモード対応
- [ ] 特性・技説明文の日本語化

## ライセンス

MIT License

## クレジット

- **PokéAPI**: https://pokeapi.co/
- **Kingfisher**: https://github.com/onevcat/Kingfisher
- ポケモンの名前、画像、データは任天堂・クリーチャーズ・ゲームフリークの著作物です

## 貢献

プルリクエストを歓迎します。大きな変更の場合は、まずIssueを開いて変更内容を議論してください。

## 連絡先

- **作成者**: Yusuke Abe
- **作成日**: 2025-10-04
- **バージョン**: 3.0.0

---

詳細なドキュメント:
- [要件定義書 v3](docs/pokedex_requirements_v3.md)
- [設計書 v3](docs/pokedex_design_v3.md)
- [要件定義書 v2](docs/pokedex_requirements_v2.md)
- [設計書 v2](docs/pokedex_design_v2.md)
- [変更履歴](CHANGELOG.md)
